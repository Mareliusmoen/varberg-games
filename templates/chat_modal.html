{% extends "base.html" %}

{% block content %}
<div class="modal fade" id="chat-modal" tabindex="-1" role="dialog" aria-labelledby="chat-modal-label" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="chat-modal-label">Chat Name</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- Messages is displayed here -->
                <ul id="chat-messages" class="list-unstyled">
                    <!-- Messages is inserted here with JavaScript -->
                </ul>
            </div>
            <div class="modal-footer">
                <input type="text" id="message-input" class="form-control" placeholder="Type your message...">
                <button type="button" id="send-button" class="btn btn-primary">Send</button>
            </div>
        </div>
    </div>
</div>


{% block page_scripts %}
<script>
    $(document).ready(function () {
        // Get the chat ID from your template (replace 'chat_id_value' with the actual chat ID)
        var chatID = 'chat_id_value';

        // Create a WebSocket connection
        var chatSocket = new WebSocket("ws://vareberg-games-a44cb52aa87b.herokuapp.com/ws/some_chat/" + chatID + "/");

        // Handle incoming messages from the server
        chatSocket.onmessage = function (e) {
            var message = JSON.parse(e.data);
            // Handle the incoming message, and append it to the chat-messages list
            var messageText = message.message;
            var isSentByUser = message.is_sent_by_user;
            var listItem = document.createElement("li");
            listItem.textContent = messageText;
            if (isSentByUser) {
                listItem.classList.add("text-right"); // Right-align user's messages
            }
            document.getElementById("chat-messages").appendChild(listItem);
        };

        // Send a message to the server when the "Send" button is clicked
        document.getElementById("send-button").addEventListener("click", function () {
            var messageInput = document.getElementById("message-input");
            var messageText = messageInput.value;
            if (messageText) {
                // Construct a message object and send it to the server
                var message = {
                    message: messageText,
                };
                chatSocket.send(JSON.stringify(message));
                messageInput.value = ""; // Clear the input field
            }
        });
    });
</script>
<script>
    $(document).ready(function () {
        $('.chat-link').click(function (event) {
            event.preventDefault();
            var chatId = $(this).data('chat-id');
            $('#chat-modal').modal('show');
            // Fetch chat messages using AJAX and display in the modal
        });
    });
</script>
{% endblock %}
{% endblock %}